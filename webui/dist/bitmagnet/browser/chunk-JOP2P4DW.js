import{E,F as K,G as U,J as I,La as lt,Ta as ct,U as X,V as Y,W as Z,X as tt,Y as et,Z as nt,b as v,ca as it,fa as u,ha as at,i as J,ia as ot,na as rt,o as T,r as k}from"./chunk-HX6RSO6I.js";import{B,Db as p,Ea as W,Fa as V,Fb as G,Ib as N,Kb as M,Mb as $,Nb as O,Ob as r,Pb as o,Qb as _,Rb as f,Sb as C,Ub as R,Xb as q,Zb as c,a as H,b as P,fc as L,gc as s,hc as m,ib as a,ic as g,jc as y,l as F,la as Q,nc as S,qa as d,tc as z,ua as x,va as A}from"./chunk-IDBLIDSQ.js";var w={error:"error",degraded:"warning",down:"warning",unknown:"pending",inactive:"circle",up:"check_circle",started:"play_circle"},st={status:"unknown",checks:[],icon:w.unknown,workers:[],error:null},mt=1e4,h=class{constructor(){this.apollo=d(J),this.resultSubject=new F(st),this.result$=this.resultSubject.asObservable(),this.result=st,this.watchQuery(),this.result$.subscribe(t=>{this.result=t})}watchQuery(){this.apollo.watchQuery({query:lt,fetchPolicy:"no-cache",pollInterval:mt}).valueChanges.pipe(B(t=>({status:t.data.health.status==="down"?"degraded":t.data.health.status,checks:t.data.health.checks.map(n=>P(H({},n),{icon:w[n.status]})),workers:t.data.workers.listAll.workers.map(n=>P(H({},n),{icon:w[n.started?"started":"inactive"]})),icon:w[t.data.health.status],error:null}))).subscribe({next:t=>this.resultSubject.next(t),error:t=>{this.resultSubject.next({status:"error",checks:[],workers:[],error:t,icon:w.error}),setTimeout(this.watchQuery.bind(this),mt)}})}};var pt=(e,t)=>t.key;function xt(e,t){if(e&1&&(r(0,"p"),s(1),o()),e&2){let n=c().$implicit,i=c();a(),y("",n("health.check_failed_with_error"),": ",i.health.result.error,"")}}function ft(e,t){if(e&1&&(r(0,"th"),s(1),o()),e&2){let n=c(2).$implicit;a(),m(n("general.error"))}}function Ct(e,t){if(e&1&&(r(0,"td"),s(1),o()),e&2){let n=c().$implicit;a(),m(n.error)}}function gt(e,t){if(e&1&&(r(0,"tr")(1,"td",2)(2,"mat-icon"),s(3),o()(),r(4,"th",3),s(5),o(),r(6,"td"),s(7),o(),p(8,Ct,2,1,"td"),o()),e&2){let n=t.$implicit,i=c(2).$implicit,l=c();a(3),m(n.icon),a(2),m(i("health.components."+n.key)),a(2),m(i("health.statuses."+n.status)),a(),M(l.health.result.status==="down"?8:-1)}}function vt(e,t){e&1&&_(0,"td")}function Mt(e,t){if(e&1&&(r(0,"tr")(1,"td",2)(2,"mat-icon"),s(3),o()(),r(4,"th",3),s(5),o(),r(6,"td"),s(7),o(),p(8,vt,1,0,"td"),o()),e&2){let n=t.$implicit,i=c(2).$implicit,l=c();a(3),m(n.icon),a(2),y(" ",i("health.worker"),": ",i("health.workers."+n.key)," "),a(2),g(" ",i("health.statuses."+(n.started?"started":"inactive"))," "),a(),M(l.health.result.status==="down"?8:-1)}}function yt(e,t){if(e&1&&(r(0,"table",1)(1,"thead")(2,"tr"),_(3,"th"),r(4,"th"),s(5),o(),r(6,"th"),s(7),o(),p(8,ft,2,1,"th"),o()(),r(9,"tbody"),$(10,gt,9,4,"tr",null,pt),$(12,Mt,9,5,"tr",null,pt),o()()),e&2){let n=c().$implicit,i=c();a(5),m(n("health.component")),a(2),m(n("general.status")),a(),M(i.health.result.status==="down"?8:-1),a(2),O(i.health.result.checks),a(2),O(i.health.result.workers)}}function St(e,t){if(e&1&&(f(0),p(1,xt,2,2,"p")(2,yt,14,3,"table",1),C()),e&2){let n=c();a(),M(n.health.result.error?1:2)}}var D=(()=>{let t=class t{constructor(){this.health=d(h)}};t.\u0275fac=function(l){return new(l||t)},t.\u0275cmp=x({type:t,selectors:[["app-health-summary"]],decls:1,vars:0,consts:[[4,"transloco"],[1,"table-health"],[1,"td-icon"],["scope","row"]],template:function(l,b){l&1&&p(0,St,3,1,"ng-container",0)},dependencies:[v,u],styles:[".table-health[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .table-health[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding-right:20px}.table-health[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{text-align:left}"]});let e=t;return e})();var wt=e=>({status:e});function bt(e,t){if(e&1&&(f(0),r(1,"mat-card",1)(2,"mat-card-header")(3,"mat-card-title")(4,"h3")(5,"mat-icon"),s(6),o(),s(7),o()()(),r(8,"mat-card-content",2),_(9,"app-health-summary"),o()(),C()),e&2){let n=t.$implicit,i=c();a(6),m(i.health.result.icon),a(),g(" ",n("health.bitmagnet_is_status",S(2,wt,n("health.statuses."+(i.health.result.error?"down":i.health.result.status))))," ")}}var Vt=(()=>{let t=class t{constructor(){this.health=d(h)}};t.\u0275fac=function(l){return new(l||t)},t.\u0275cmp=x({type:t,selectors:[["app-health-card"]],decls:1,vars:0,consts:[[4,"transloco"],[1,"dashboard-card","dashboard-card-health"],[1,"dashboard-card-content"]],template:function(l,b){l&1&&p(0,bt,10,4,"ng-container",0)},dependencies:[v,u,E,U,I,K,D],styles:[".dashboard-card-health[_ngcontent-%COMP%]{position:absolute;inset:15px}.dashboard-card-health[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin-top:0}.dashboard-card-health[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{position:relative;top:3px;margin-left:4px;margin-right:6px}"]});let e=t;return e})();var _t=e=>({status:e});function Tt(e,t){if(e&1&&(r(0,"h2",3),s(1),o(),r(2,"mat-dialog-content"),_(3,"app-health-summary"),o(),r(4,"mat-dialog-actions")(5,"button",4),s(6),o()()),e&2){let n=c().$implicit,i=c();a(),y(" ",n("health.summary"),": ",n("health.bitmagnet_is_status",S(3,_t,n("health.statuses."+(i.health.result.error?"down":i.health.result.status))))," "),a(5),g(" ",n("general.dismiss")," ")}}function kt(e,t){if(e&1){let n=R();f(0),r(1,"button",2),q("click",function(){W(n);let l=L(5),b=c();return V(b.dialog.open(l))}),r(2,"mat-icon"),s(3),o()(),p(4,Tt,7,5,"ng-template",null,0,z),C()}if(e&2){let n=t.$implicit,i=c();a(),N("health-icon health-icon-"+i.health.result.status),G("matTooltip",n("health.bitmagnet_is_status",S(4,_t,n("health.statuses."+i.health.result.status)))),a(2),m(i.health.result.icon)}}var Ut=(()=>{let t=class t{constructor(){this.health=d(h),this.dialog=d(X)}};t.\u0275fac=function(l){return new(l||t)},t.\u0275cmp=x({type:t,selectors:[["app-health-widget"]],decls:1,vars:0,consts:[["healthDialog",""],[4,"transloco"],["mat-icon-button","",3,"click","matTooltip"],["matDialogTitle",""],["mat-button","","matDialogClose","","color","primary"]],template:function(l,b){l&1&&p(0,kt,6,6,"ng-container",1)},dependencies:[v,u,rt,Y,Z,et,tt,T,k,D]});let e=t;return e})();var _e=(()=>{let t=class t{};t.\u0275fac=function(l){return new(l||t)},t.\u0275mod=A({type:t}),t.\u0275inj=Q({providers:[h],imports:[ct,u,nt,T,k,E,I,it,ot,at]});let e=t;return e})();export{h as a,Vt as b,Ut as c,_e as d};
