import{g as oe,j as ae}from"./chunk-6OKZFKY7.js";import{b as ie}from"./chunk-PX3TOMGC.js";import{a as Y}from"./chunk-ASLGZ7DJ.js";import{a as ne}from"./chunk-DSEDLZDW.js";import{A as H,J as K,L as W,M as X,P as q,R as Z,Ua as y,b as k,ba as R,ca as N,da as ee,fa as A,ga as B,ha as J,i as I,n as L,o as V,p as U,wa as O,z,za as te}from"./chunk-VAEZNV34.js";import"./chunk-6XXA7HXI.js";import"./chunk-CMNWCZJM.js";import{$b as a,B as F,Cb as b,Ea as m,Fa as p,Hb as h,Mb as S,N as P,Nb as G,Ob as Q,Pb as w,Qb as s,Rb as r,Sb as g,Tb as E,Ub as T,Wb as x,Zb as _,kb as i,kc as c,lc as d,mc as f,nc as $,o as M,pc as v,qa as C,tc as j,ua as D}from"./chunk-Z3WUIYN5.js";var ge=(n,u)=>u.key;function xe(n,u){if(n&1&&(s(0,"mat-option",8),c(1),r()),n&2){let e=u.$implicit,t=a(2).$implicit;h("value",e.key),i(),f(" ",t("content_types.plural."+e.key)," ")}}function fe(n,u){if(n&1){let e=x();s(0,"section")(1,"mat-checkbox",4),_("change",function(o){m(e);let l=a(2);return p(l.purge=o.checked)}),c(2),r(),g(3,"br"),s(4,"mat-checkbox",4),_("change",function(o){m(e);let l=a(2);return l.localSearchDisabled=!o.checked,p(l.apisDisabled=l.localSearchDisabled?!0:l.apisDisabled)}),c(5),r(),g(6,"br"),s(7,"mat-checkbox",4),_("change",function(o){m(e);let l=a(2);return l.apisDisabled=!o.checked,p(l.localSearchDisabled=l.apisDisabled?l.localSearchDisabled:!0)}),c(8),r(),g(9,"br"),s(10,"mat-checkbox",4),_("change",function(o){m(e);let l=a(2);return p(l.classifierRematch=o.checked)}),c(11),r(),g(12,"br"),s(13,"mat-checkbox",4),_("change",function(o){m(e);let l=a(2);return l.orphans=o.checked,p(l.contentTypes=o.checked?["all"]:l.contentTypes)}),c(14),r(),g(15,"br"),s(16,"mat-form-field",5)(17,"mat-label"),c(18),r(),s(19,"mat-select",6),_("selectionChange",function(o){m(e);let l=a(2);return p(l.onContentTypeSelectionChange(o))}),s(20,"mat-option",7),c(21),r(),Q(22,xe,2,2,"mat-option",8,ge),r()()()}if(n&2){let e=a().$implicit,t=a();i(),h("checked",t.purge),i(),d(e("dashboard.queues.purge_queue_jobs")),i(2),h("checked",!t.apisDisabled),i(),d(e("dashboard.queues.match_content_by_local_search")),i(2),h("checked",!t.apisDisabled),i(),d(e("dashboard.queues.match_content_by_external_api_search")),i(2),h("checked",t.classifierRematch),i(),d(e("dashboard.queues.force_rematch")),i(2),h("checked",t.orphans),i(),d(e("dashboard.queues.process_orphaned_torrents_only")),i(4),d(e("facets.content_type")),i(),h("value",t.contentTypes),i(2),d(e("general.all")),i(),w(t.allContentTypes)}}function Ce(n,u){n&1&&g(0,"mat-spinner")}function be(n,u){if(n&1&&(s(0,"p"),c(1),r()),n&2){let e=a().$implicit;i(),d(e("dashboard.queues.jobs_enqueued"))}}function De(n,u){if(n&1){let e=x();E(0),s(1,"mat-card")(2,"h2",1),c(3),r(),s(4,"mat-dialog-content"),b(5,fe,24,13,"section")(6,Ce,1,0,"mat-spinner")(7,be,2,1,"p"),r(),s(8,"mat-dialog-actions")(9,"button",2),_("click",function(){m(e);let o=a();return p(o.handleEnqueue())}),c(10),r(),s(11,"button",3),_("click",function(){m(e);let o=a();return p(o.dialogRef.close())}),c(12),r()()(),T()}if(n&2){let e=u.$implicit,t=a();i(3),f(" ",e("dashboard.queues.enqueue_torrent_processing_batch")," "),i(2),S(t.stage==="PENDING"?5:t.stage==="REQUESTING"?6:t.stage==="DONE"?7:-1),i(4),h("disabled",t.stage!=="PENDING"),i(),f(" ",e("dashboard.queues.enqueue_jobs")," "),i(2),f(" ",e("general.dismiss")," ")}}var ue=(()=>{class n{constructor(){this.apollo=C(I),this.dialogRef=C(N),this.errorsService=C(Y),this.allContentTypes=ie,this.stage="PENDING",this.purge=!0,this.apisDisabled=!0,this.localSearchDisabled=!0,this.classifierRematch=!1,this.contentTypes=["all"],this.orphans=!1}handleEnqueue(){this.stage==="PENDING"&&(this.stage="REQUESTING",this.apollo.mutate({mutation:z,variables:{input:{purge:this.purge,apisDisabled:this.apisDisabled,localSearchDisabled:this.localSearchDisabled,classifierRematch:this.classifierRematch,contentTypes:this.contentTypes.includes("all")?void 0:this.contentTypes.map(e=>e==="null"?null:e),orphans:this.orphans?!0:void 0}}}).pipe(P(e=>(this.errorsService.addError(e.message),this.dialogRef.close(),M))).subscribe(()=>{this.stage="DONE",this.data.onEnqueued?.()}))}onContentTypeSelectionChange(e){!Array.isArray(e.value)||!e.value.length||e.value.includes("all")&&(!this.contentTypes.includes("all")||e.value.length===1)?this.contentTypes=["all"]:(this.orphans=!1,this.contentTypes=this.allContentTypes.map(t=>t.key).filter(t=>e.value.includes(t)))}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275cmp=D({type:n,selectors:[["app-queue-enqueue-reprocess-torrents-batch-dialog"]],standalone:!0,features:[v],decls:1,vars:0,consts:[[4,"transloco"],["mat-dialog-title",""],["mat-stroked-button","","color","warning",3,"click","disabled"],["mat-stroked-button","",3,"click"],[3,"change","checked"],[1,"select-content-types"],["multiple","",3,"selectionChange","value"],["value","all"],[3,"value"]],template:function(t,o){t&1&&b(0,De,13,5,"ng-container",0)},dependencies:[y,L,V,q,R,A,J,B,X,W,O,te,k],styles:["mat-dialog-content[_ngcontent-%COMP%]{min-height:240px;overflow:visible}mat-grid-tile[_ngcontent-%COMP%]   mat-card[_ngcontent-%COMP%]{width:100%;height:100%}.select-content-types[_ngcontent-%COMP%]{margin-top:10px}"]})}}return n})();function Ee(n,u){if(n&1){let e=x();s(0,"mat-checkbox",6),_("change",function(o){m(e);let l=a(3);return p(l.handleQueueEvent(o))}),c(1),r()}if(n&2){let e=u.$implicit,t=a(3);h("value",e)("checked",t.queues==null?null:t.queues.includes(e)),i(),d(e)}}function Te(n,u){if(n&1){let e=x();s(0,"mat-checkbox",6),_("change",function(o){m(e);let l=a(3);return p(l.handleStatusEvent(o))}),c(1),r()}if(n&2){let e=u.$implicit,t=a(2).$implicit,o=a();h("value",e)("checked",o.statuses==null?null:o.statuses.includes(e)),i(),d(t("general.status"))}}function ve(n,u){if(n&1){let e=x();s(0,"section")(1,"h4"),c(2),r(),s(3,"mat-checkbox",4),_("change",function(o){m(e);let l=a(2);return p(l.handleQueueEvent(o))}),c(4),r(),Q(5,Ee,2,3,"mat-checkbox",5,G),r(),s(7,"section")(8,"h4"),c(9),r(),s(10,"mat-checkbox",4),_("change",function(o){m(e);let l=a(2);return p(l.handleStatusEvent(o))}),c(11),r(),Q(12,Te,2,3,"mat-checkbox",5,G),r()}if(n&2){let e=a().$implicit,t=a();i(2),f("",e("dashboard.queues.queues"),":"),i(),h("checked",t.queues===void 0),i(),d(e("general.all")),i(),w(t.availableQueueNames),i(4),f("",e("general.status"),":"),i(),h("checked",t.statuses===void 0),i(),d(e("general.all")),i(),w(t.statusNames)}}function ke(n,u){n&1&&g(0,"mat-spinner")}function qe(n,u){if(n&1&&(s(0,"p"),c(1),r()),n&2){let e=a(2).$implicit,t=a();i(),$("",e("general.error"),": ",t.error.message,"")}}function ye(n,u){if(n&1&&(s(0,"p"),c(1),r()),n&2){let e=a(2).$implicit;i(),d(e("dashboard.queues.queue_purged"))}}function Se(n,u){if(n&1&&b(0,qe,2,2,"p")(1,ye,2,1,"p"),n&2){let e=a(2);S(e.error?0:1)}}function Qe(n,u){if(n&1){let e=x();E(0),s(1,"mat-card")(2,"h2",1),c(3),r(),s(4,"mat-dialog-content"),b(5,ve,14,6)(6,ke,1,0,"mat-spinner")(7,Se,2,1),r(),s(8,"mat-dialog-actions")(9,"button",2),_("click",function(){m(e);let o=a();return p(o.handlePurgeJobs())}),c(10),r(),s(11,"button",3),_("click",function(){m(e);let o=a();return p(o.dialogRef.close())}),c(12),r()()(),T()}if(n&2){let e=u.$implicit,t=a();i(3),d(e("dashboard.queues.purge_queue_jobs")),i(2),S(t.stage==="PENDING"?5:t.stage==="REQUESTING"?6:t.stage==="DONE"?7:-1),i(4),h("disabled",t.stage!=="PENDING"),i(),f(" ",e("dashboard.queues.purge_jobs")," "),i(2),f(" ",e("general.dismiss")," ")}}var me=(()=>{class n{constructor(){this.apollo=C(I),this.dialogRef=C(N),this.availableQueueNames=ae,this.statusNames=oe,this.stage="PENDING"}handleQueueEvent(e){if(e.source.value==="_all"){this.queues=void 0;return}if(e.checked){let t=this.queues??[];t.includes(e.source.value)||(t=[...t,e.source.value]),t.length===this.availableQueueNames.length?(e.source.checked=!1,this.queues=void 0):this.queues=t}else{let t=this.queues?.filter(o=>o!==e.source.value);t?.length?this.queues=t:this.queues=void 0}}handleStatusEvent(e){if(e.source.value==="_all"){this.statuses=void 0;return}if(e.checked){let t=this.statuses??[];t.includes(e.source.value)||(t=[...t,e.source.value]),t.length===this.statusNames.length?(e.source.checked=!1,this.statuses=void 0):this.statuses=t}else{let t=this.statuses?.filter(o=>o!==e.source.value);t?.length?this.statuses=t:this.statuses=void 0}}handlePurgeJobs(){this.stage==="PENDING"&&(this.stage="REQUESTING",this.apollo.mutate({mutation:H,variables:{input:{queues:this.queues,statuses:this.statuses}}}).pipe(P(e=>(this.stage="DONE",this.error=e,M)),F(()=>{this.stage="DONE",this.data?.onPurged?.()})).subscribe())}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275cmp=D({type:n,selectors:[["app-queue-purge-jobs-dialog"]],standalone:!0,features:[v],decls:1,vars:0,consts:[[4,"transloco"],["mat-dialog-title",""],["mat-stroked-button","","color","warning",3,"click","disabled"],["mat-stroked-button","",3,"click"],["value","_all",3,"change","checked"],[3,"value","checked"],[3,"change","value","checked"]],template:function(t,o){t&1&&b(0,Qe,13,5,"ng-container",0)},dependencies:[y,V,q,R,A,J,B,O,k,K],styles:["mat-dialog-content[_ngcontent-%COMP%]{min-height:240px;overflow:visible}mat-grid-tile[_ngcontent-%COMP%]   mat-card[_ngcontent-%COMP%]{width:100%;height:100%}"]})}}return n})();var we=(n,u,e)=>[n,u,e];function Me(n,u){if(n&1){let e=x();E(0),g(1,"app-document-title",1),s(2,"mat-card")(3,"mat-card-content")(4,"ul")(5,"li")(6,"a",2),_("click",function(){m(e);let o=a();return p(o.openDialogPurgeJobs())}),c(7),r()(),s(8,"li")(9,"a",2),_("click",function(){m(e);let o=a();return p(o.openDialogEnqueueReprocessTorrentsBatch())}),c(10),r()()()()(),T()}if(n&2){let e=u.$implicit;i(),h("parts",j(3,we,e("routes.admin"),e("routes.queues"),e("routes.dashboard"))),i(6),d(e("dashboard.queues.purge_queue_jobs")),i(3),d(e("dashboard.queues.enqueue_torrent_processing_batch"))}}var mt=(()=>{class n{constructor(){this.dialog=C(ee)}openDialogPurgeJobs(){this.dialog.open(me)}openDialogEnqueueReprocessTorrentsBatch(){this.dialog.open(ue)}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275cmp=D({type:n,selectors:[["app-queue-admin"]],standalone:!0,features:[v],decls:1,vars:0,consts:[[4,"transloco"],[3,"parts"],["mat-button","",3,"click"]],template:function(t,o){t&1&&b(0,Me,11,7,"ng-container",0)},dependencies:[y,U,q,Z,k,ne],styles:["ul[_ngcontent-%COMP%]{list-style-type:none;padding-left:0}ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{margin-bottom:6px}"]})}}return n})();export{mt as QueueAdminComponent};
