import{b as be,c as he}from"./chunk-OS3AV5XL.js";import{a as ee}from"./chunk-AMUSMSN6.js";import{a as te}from"./chunk-BRPPGP57.js";import{A as ie,B as ne,E as re,F as oe,G as ae,J as se,Ma as ge,S as ce,Ua as fe,a as W,b as Y,fa as le,h as G,i as K,n as U,na as ue,oa as pe,pa as me,q as X,qa as de,r as Z,ra as _e}from"./chunk-EH7PJXWD.js";import"./chunk-6XXA7HXI.js";import"./chunk-FKMTSCBK.js";import{$b as l,$c as H,B as C,Cb as $,Ea as _,Fa as g,Gb as Q,Hb as d,Mb as L,N as E,O as I,Ob as S,Pb as y,Q as J,Qb as a,Rb as c,Sb as A,Tb as D,Ub as R,Wb as M,Zb as f,_c as N,a as s,b as p,jc as P,kb as o,kc as m,l as b,lc as x,mc as w,o as F,pc as z,qa as v,ua as V,uc as k,vc as O}from"./chunk-3DR3CJRN.js";var Se={items:[],hasNextPage:!1,totalCount:0,aggregations:{queue:[],status:[]}},q=class{constructor(n,t,r){this.apollo=n,this.errorsService=t,this.currentRequest=new b(0),this.loadingSubject=new b(!1),this.loading$=this.loadingSubject.asObservable(),this.result=Se,this.resultSubject=new b(this.result),this.result$=this.resultSubject.asObservable(),this.items$=this.resultSubject.pipe(C(i=>i.items)),r.subscribe(i=>{this.variables=i,this.loadResult(i)}),this.resultSubject.subscribe(i=>{this.result=i})}connect({}){return this.items$}disconnect(){this.resultSubject.complete()}refresh(){this.variables&&this.loadResult(this.variables)}loadResult(n){this.currentSubscription&&(this.currentSubscription.unsubscribe(),this.currentSubscription=void 0),this.loadingSubject.next(!0);let t=this.currentRequest.getValue()+1;this.currentRequest.next(t);let r=this.apollo.query({query:ge,variables:n,fetchPolicy:"no-cache"}).pipe(C(i=>i.data.queue.jobs)).pipe(E(i=>(this.errorsService.addError(`Error loading item results: ${i.message}`),F)));this.currentSubscription=r.subscribe(i=>{t===this.currentRequest.getValue()&&(this.loadingSubject.next(!1),this.resultSubject.next(i))})}};var T=class{constructor(n=ye){this.controlsSubject=new b(n),this.controls$=this.controlsSubject.asObservable(),this.variablesSubject=new b(xe(n)),this.variables$=this.variablesSubject.asObservable(),this.controls$.pipe(J(100)).subscribe(t=>{let r=this.variablesSubject.getValue(),i=xe(t);JSON.stringify(r)!==JSON.stringify(i)&&this.variablesSubject.next(i)})}update(n){let t=this.controlsSubject.getValue(),r=n(t);JSON.stringify(t)!==JSON.stringify(r)&&this.controlsSubject.next(r)}activateFilter(n,t){this.update(r=>{let i=n.extractInput(r.facets);return p(s({},r),{page:1,facets:n.patchInput(r.facets,p(s({},i),{filter:Array.from(new Set([...i.filter??[],t])).sort()}))})})}deactivateFilter(n,t){this.update(r=>{let i=n.extractInput(r.facets),u=i.filter?.filter(h=>h!==t);return p(s({},r),{page:1,facets:n.patchInput(r.facets,p(s({},i),{filter:u?.length?u:void 0}))})})}selectOrderBy(n){let t={field:n,descending:B.find(r=>r.field===n)?.descending??!1};this.update(r=>p(s({},r),{orderBy:t,page:1}))}toggleOrderByDirection(){this.update(n=>p(s({},n),{orderBy:p(s({},n.orderBy),{descending:!n.orderBy.descending}),page:1}))}handlePageEvent(n){this.update(t=>p(s({},t),{limit:n.pageSize,page:n.page}))}},xe=e=>({input:{limit:e.limit,page:e.page,totalCount:!0,orderBy:[e.orderBy,...e.orderBy.field!=="created_at"?[{field:"created_at",descending:e.orderBy.descending}]:[]],queues:e.queues,statuses:e.statuses,facets:{queue:{aggregate:!0,filter:e.facets.queue.filter},status:{aggregate:!0,filter:e.facets.status.filter}}}}),B=[{field:"created_at",descending:!0},{field:"ran_at",descending:!0},{field:"priority",descending:!1}],ye={limit:20,page:1,orderBy:{field:"ran_at",descending:!0},facets:{queue:{},status:{}}},we={key:"queue",extractInput:e=>e.queue,patchInput:(e,n)=>p(s({},e),{queue:n}),extractAggregations:e=>e.queue??[],resolveLabel:e=>e.label},Me={key:"status",extractInput:e=>e.status,patchInput:(e,n)=>p(s({},e),{status:n}),extractAggregations:e=>e.status??[],resolveLabel:(e,n)=>n.translate("queue.statuses."+e.label)},Ce=[we,Me];var ke=(e,n)=>n.key,Oe=(e,n)=>n.field,ve=(e,n)=>n.value;function qe(e,n){if(e&1){let t=M();a(0,"mat-checkbox",20),f("change",function(i){let u=_(t).$implicit,h=l(2).$implicit,j=l(2);return g(i.checked?j.controller.activateFilter(h,u.value):j.controller.deactivateFilter(h,u.value))}),m(1),a(2,"small"),m(3),k(4,"number"),c()()}if(e&2){let t=n.$implicit,r=l(2).$implicit;d("checked",r.filter==null?null:r.filter.includes(t.value)),o(),w(" ",t.label," "),o(2),x(O(4,3,t.count))}}function Te(e,n){if(e&1&&(a(0,"mat-card-content",17),S(1,qe,5,5,"mat-checkbox",19,ve),c()),e&2){let t=l().$implicit;o(),y(t.aggregations)}}function $e(e,n){if(e&1){let t=M();a(0,"mat-checkbox",22),f("change",function(){let i=_(t).$implicit,u=l(2).$implicit,h=l(2);return g(h.controller.activateFilter(u,i.value))}),m(1),a(2,"small"),m(3),k(4,"number"),c()()}if(e&2){let t=n.$implicit;o(),w(" ",t.label," "),o(2),x(O(4,2,t.count))}}function Pe(e,n){if(e&1&&(a(0,"mat-card-content",18),S(1,$e,5,4,"mat-checkbox",21,ve),c()),e&2){let t=l().$implicit;o(),y(t.aggregations)}}function Be(e,n){if(e&1&&(a(0,"mat-card")(1,"mat-card-header")(2,"mat-card-title"),m(3),c()(),$(4,Te,3,0,"mat-card-content",17)(5,Pe,3,0,"mat-card-content",18),c()),e&2){let t=n.$implicit,r=l().$implicit;o(3),w(" ",r("queue_facets."+t.key)," "),o(),L(t.filter!=null&&t.filter.length?4:5)}}function je(e,n){if(e&1&&(a(0,"mat-option",11),m(1),c()),e&2){let t=n.$implicit,r=l().$implicit;d("value",t.field),o(),w(" ",r("queue_jobs.order_by_"+t.field)," ")}}function Fe(e,n){if(e&1){let t=M();D(0),a(1,"mat-drawer-container",2)(2,"mat-drawer",3,0),S(4,Be,6,2,"mat-card",null,ke),k(6,"async"),c(),a(7,"mat-drawer-content")(8,"div",4)(9,"div",5)(10,"button",6),f("click",function(){_(t);let i=P(3);return g(i.toggle())}),a(11,"mat-icon",7),m(12),c()()(),a(13,"div",8)(14,"mat-form-field",9)(15,"mat-label"),m(16),c(),a(17,"mat-select",10),f("valueChange",function(i){_(t);let u=l();return g(u.controller.selectOrderBy(i))}),S(18,je,2,2,"mat-option",11,Oe),c()(),a(20,"button",12),f("click",function(){_(t);let i=l();return g(i.controller.toggleOrderByDirection())}),a(21,"mat-icon"),m(22),c()()(),a(23,"div",13)(24,"button",14),f("click",function(){_(t);let i=l();return g(i.dataSource.refresh())}),a(25,"mat-icon"),m(26,"sync"),c()()()(),A(27,"app-queue-jobs-table",15),a(28,"app-paginator",16),f("paging",function(i){_(t);let u=l();return g(u.controller.handlePageEvent(i))}),c()()(),R()}if(e&2){let t=n.$implicit,r=P(3),i=l();o(2),d("mode",i.breakpoints.sizeAtLeast("Medium")?"side":"over")("opened",i.breakpoints.sizeAtLeast("Medium")),Q("role",i.breakpoints.sizeAtLeast("Medium")?"navigation":"dialog"),o(2),y(O(6,18,i.facets$)),o(6),d("matTooltip",t("torrents.toggle_drawer")),o(2),x(r.opened?"arrow_circle_left":"arrow_circle_right"),o(4),x(t("torrents.order_by")),o(),d("value",i.controls.orderBy.field),o(),y(i.orderByOptions),o(2),d("matTooltip",t("torrents.order_direction_toggle")),o(2),x(i.controls.orderBy.descending?"arrow_downward":"arrow_upward"),o(2),d("matTooltip",t("torrents.refresh")),o(3),d("dataSource",i.dataSource)("selection",i.selection),o(),d("page",i.controls.page)("pageSize",i.controls.limit)("pageLength",i.dataSource.result.items.length)("totalLength",i.dataSource.result.totalCount)("totalIsEstimate",!1)("showLastPage",!0)}}var _t=(()=>{class e{constructor(){this.apollo=v(K),this.errorsService=v(ee),this.breakpoints=v(te),this.transloco=v(W),this.controller=new T,this.dataSource=new q(this.apollo,this.errorsService,this.controller.variables$),this.selection=new G,this.orderByOptions=B,this.facets$=this.controller.controls$.pipe(I(this.dataSource.result$),C(([t,r])=>Ce.map(i=>p(s(s({},i),i.extractInput(t.facets)),{aggregations:i.extractAggregations(r.aggregations).map(u=>p(s({},u),{label:i.resolveLabel(u,this.transloco)}))})))),this.controller.controls$.subscribe(t=>{this.controls=t})}static{this.\u0275fac=function(r){return new(r||e)}}static{this.\u0275cmp=V({type:e,selectors:[["app-queue-jobs"]],standalone:!0,features:[z],decls:1,vars:0,consts:[["drawer",""],[4,"transloco"],[1,"drawer-container"],[1,"drawer",3,"mode","opened"],[1,"query-form"],[1,"form-field-container","button-container","button-container-toggle-drawer"],["type","button","mat-icon-button","",1,"button-toggle-drawer",3,"click","matTooltip"],["fontSet","material-icons"],[1,"form-field-container","form-field-container-order-by"],["subscriptSizing","dynamic"],[3,"valueChange","value"],[3,"value"],["mat-icon-button","",3,"click","matTooltip"],[1,"form-field-container","button-container","button-container-refresh"],["mat-mini-fab","","color","primary",3,"click","matTooltip"],[3,"dataSource","selection"],[3,"paging","page","pageSize","pageLength","totalLength","totalIsEstimate","showLastPage"],[1,"filtered"],[1,"unfiltered"],[3,"checked"],[3,"change","checked"],["checked","true"],["checked","true",3,"change"]],template:function(r,i){r&1&&$(0,Fe,29,20,"ng-container",1)},dependencies:[fe,U,Z,X,re,ae,se,oe,ce,ne,ie,le,pe,de,_e,me,ue,Y,N,H,be,he],styles:[".drawer[_ngcontent-%COMP%]{width:220px}.query-form[_ngcontent-%COMP%]{padding-top:20px;padding-bottom:10px;position:relative;clear:both;display:flex;flex-wrap:wrap}.query-form[_ngcontent-%COMP%]   .form-field-container[_ngcontent-%COMP%]{display:inline-flex;flex-direction:column;position:relative;margin-left:20px;padding-bottom:20px}.query-form[_ngcontent-%COMP%]   .form-field-container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{top:8px}.query-form[_ngcontent-%COMP%]   .form-field-container.form-field-container-order-by[_ngcontent-%COMP%]{padding-right:40px}.query-form[_ngcontent-%COMP%]   .form-field-container.form-field-container-order-by[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{position:absolute;right:0}.query-form[_ngcontent-%COMP%]   .form-field-container.button-container-toggle-drawer[_ngcontent-%COMP%]{margin-left:5px}.query-form[_ngcontent-%COMP%]   .button-container-toggle-direction[_ngcontent-%COMP%]{margin-left:4px}app-paginator[_ngcontent-%COMP%]{float:right;padding-top:14px;padding-bottom:20px}"]})}}return e})();export{_t as QueueJobsComponent};
