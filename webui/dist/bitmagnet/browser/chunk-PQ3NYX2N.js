import{b as be,c as he}from"./chunk-FYKYJK2Q.js";import{a as ee}from"./chunk-QPOWPIPD.js";import{a as te}from"./chunk-W3DXNNS4.js";import{A as ie,B as ne,E as re,F as oe,G as ae,J as se,Ma as ge,S as ce,Ua as fe,a as W,b as Y,fa as le,h as G,i as K,n as U,na as ue,oa as pe,pa as me,q as X,qa as de,r as Z,ra as _e}from"./chunk-FRQ6MKZA.js";import"./chunk-JGYM447R.js";import"./chunk-6GS6ZYTX.js";import{B as C,Db as $,Ea as g,Eb as Q,Fa as f,Fb as d,Kb as L,Mb as S,N as E,Nb as y,O as I,Ob as a,Pb as l,Q as V,Qb as A,Rb as D,Sb as R,Ub as M,Vc as N,Wc as H,Xb as b,Zb as u,a as c,b as p,fc as P,gc as m,hc as x,ib as o,ic as w,l as h,lc as z,o as F,qa as v,qc as k,rc as O,ua as J}from"./chunk-IDBLIDSQ.js";var Se={items:[],hasNextPage:!1,totalCount:0,aggregations:{queue:[],status:[]}},q=class{constructor(t,n,r){this.apollo=t,this.errorsService=n,this.currentRequest=new h(0),this.loadingSubject=new h(!1),this.loading$=this.loadingSubject.asObservable(),this.result=Se,this.resultSubject=new h(this.result),this.result$=this.resultSubject.asObservable(),this.items$=this.resultSubject.pipe(C(i=>i.items)),r.subscribe(i=>{this.variables=i,this.loadResult(i)}),this.resultSubject.subscribe(i=>{this.result=i})}connect({}){return this.items$}disconnect(){this.resultSubject.complete()}refresh(){this.variables&&this.loadResult(this.variables)}loadResult(t){this.currentSubscription&&(this.currentSubscription.unsubscribe(),this.currentSubscription=void 0),this.loadingSubject.next(!0);let n=this.currentRequest.getValue()+1;this.currentRequest.next(n);let r=this.apollo.query({query:ge,variables:t,fetchPolicy:"no-cache"}).pipe(C(i=>i.data.queue.jobs)).pipe(E(i=>(this.errorsService.addError(`Error loading item results: ${i.message}`),F)));this.currentSubscription=r.subscribe(i=>{n===this.currentRequest.getValue()&&(this.loadingSubject.next(!1),this.resultSubject.next(i))})}};var T=class{constructor(t=ye){this.controlsSubject=new h(t),this.controls$=this.controlsSubject.asObservable(),this.variablesSubject=new h(xe(t)),this.variables$=this.variablesSubject.asObservable(),this.controls$.pipe(V(100)).subscribe(n=>{let r=this.variablesSubject.getValue(),i=xe(n);JSON.stringify(r)!==JSON.stringify(i)&&this.variablesSubject.next(i)})}update(t){let n=this.controlsSubject.getValue(),r=t(n);JSON.stringify(n)!==JSON.stringify(r)&&this.controlsSubject.next(r)}activateFilter(t,n){this.update(r=>{let i=t.extractInput(r.facets);return p(c({},r),{page:1,facets:t.patchInput(r.facets,p(c({},i),{filter:Array.from(new Set([...i.filter??[],n])).sort()}))})})}deactivateFilter(t,n){this.update(r=>{let i=t.extractInput(r.facets),s=i.filter?.filter(_=>_!==n);return p(c({},r),{page:1,facets:t.patchInput(r.facets,p(c({},i),{filter:s?.length?s:void 0}))})})}selectOrderBy(t){let n={field:t,descending:B.find(r=>r.field===t)?.descending??!1};this.update(r=>p(c({},r),{orderBy:n,page:1}))}toggleOrderByDirection(){this.update(t=>p(c({},t),{orderBy:p(c({},t.orderBy),{descending:!t.orderBy.descending}),page:1}))}handlePageEvent(t){this.update(n=>p(c({},n),{limit:t.pageSize,page:t.page}))}},xe=e=>({input:{limit:e.limit,page:e.page,totalCount:!0,orderBy:[e.orderBy,...e.orderBy.field!=="created_at"?[{field:"created_at",descending:e.orderBy.descending}]:[]],queues:e.queues,statuses:e.statuses,facets:{queue:{aggregate:!0,filter:e.facets.queue.filter},status:{aggregate:!0,filter:e.facets.status.filter}}}}),B=[{field:"created_at",descending:!0},{field:"ran_at",descending:!0},{field:"priority",descending:!1}],ye={limit:20,page:1,orderBy:{field:"ran_at",descending:!0},facets:{queue:{},status:{}}},we={key:"queue",extractInput:e=>e.queue,patchInput:(e,t)=>p(c({},e),{queue:t}),extractAggregations:e=>e.queue??[],resolveLabel:e=>e.label},Me={key:"status",extractInput:e=>e.status,patchInput:(e,t)=>p(c({},e),{status:t}),extractAggregations:e=>e.status??[],resolveLabel:(e,t)=>t.translate("queue.statuses."+e.label)},Ce=[we,Me];var ke=(e,t)=>t.key,Oe=(e,t)=>t.field,ve=(e,t)=>t.value;function qe(e,t){if(e&1){let n=M();a(0,"mat-checkbox",20),b("change",function(i){let s=g(n).$implicit,_=u(2).$implicit,j=u(2);return f(i.checked?j.controller.activateFilter(_,s.value):j.controller.deactivateFilter(_,s.value))}),m(1),a(2,"small"),m(3),k(4,"number"),l()()}if(e&2){let n=t.$implicit,r=u(2).$implicit;d("checked",r.filter==null?null:r.filter.includes(n.value)),o(),w(" ",n.label," "),o(2),x(O(4,3,n.count))}}function Te(e,t){if(e&1&&(a(0,"mat-card-content",17),S(1,qe,5,5,"mat-checkbox",19,ve),l()),e&2){let n=u().$implicit;o(),y(n.aggregations)}}function $e(e,t){if(e&1){let n=M();a(0,"mat-checkbox",22),b("change",function(){let i=g(n).$implicit,s=u(2).$implicit,_=u(2);return f(_.controller.activateFilter(s,i.value))}),m(1),a(2,"small"),m(3),k(4,"number"),l()()}if(e&2){let n=t.$implicit;o(),w(" ",n.label," "),o(2),x(O(4,2,n.count))}}function Pe(e,t){if(e&1&&(a(0,"mat-card-content",18),S(1,$e,5,4,"mat-checkbox",21,ve),l()),e&2){let n=u().$implicit;o(),y(n.aggregations)}}function Be(e,t){if(e&1&&(a(0,"mat-card")(1,"mat-card-header")(2,"mat-card-title"),m(3),l()(),$(4,Te,3,0,"mat-card-content",17)(5,Pe,3,0,"mat-card-content",18),l()),e&2){let n=t.$implicit,r=u().$implicit;o(3),w(" ",r("queue_facets."+n.key)," "),o(),L(n.filter!=null&&n.filter.length?4:5)}}function je(e,t){if(e&1&&(a(0,"mat-option",11),m(1),l()),e&2){let n=t.$implicit,r=u().$implicit;d("value",n.field),o(),w(" ",r("queue_jobs.order_by_"+n.field)," ")}}function Fe(e,t){if(e&1){let n=M();D(0),a(1,"mat-drawer-container",2)(2,"mat-drawer",3,0),S(4,Be,6,2,"mat-card",null,ke),k(6,"async"),l(),a(7,"mat-drawer-content")(8,"div",4)(9,"div",5)(10,"button",6),b("click",function(){g(n);let i=P(3);return f(i.toggle())}),a(11,"mat-icon",7),m(12),l()()(),a(13,"div",8)(14,"mat-form-field",9)(15,"mat-label"),m(16),l(),a(17,"mat-select",10),b("valueChange",function(i){g(n);let s=u();return f(s.controller.selectOrderBy(i))}),S(18,je,2,2,"mat-option",11,Oe),l()(),a(20,"button",12),b("click",function(){g(n);let i=u();return f(i.controller.toggleOrderByDirection())}),a(21,"mat-icon"),m(22),l()()(),a(23,"div",13)(24,"button",14),b("click",function(){g(n);let i=u();return f(i.dataSource.refresh())}),a(25,"mat-icon"),m(26,"sync"),l()()()(),A(27,"app-queue-jobs-table",15),a(28,"app-paginator",16),b("paging",function(i){g(n);let s=u();return f(s.controller.handlePageEvent(i))}),l()()(),R()}if(e&2){let n=t.$implicit,r=P(3),i=u();o(2),d("mode",i.breakpoints.sizeAtLeast("Medium")?"side":"over")("opened",i.breakpoints.sizeAtLeast("Medium")),Q("role",i.breakpoints.sizeAtLeast("Medium")?"navigation":"dialog"),o(2),y(O(6,18,i.facets$)),o(6),d("matTooltip",n("torrents.toggle_drawer")),o(2),x(r.opened?"arrow_circle_left":"arrow_circle_right"),o(4),x(n("torrents.order_by")),o(),d("value",i.controls.orderBy.field),o(),y(i.orderByOptions),o(2),d("matTooltip",n("torrents.order_direction_toggle")),o(2),x(i.controls.orderBy.descending?"arrow_downward":"arrow_upward"),o(2),d("matTooltip",n("torrents.refresh")),o(3),d("dataSource",i.dataSource)("selection",i.selection),o(),d("page",i.controls.page)("pageSize",i.controls.limit)("pageLength",i.dataSource.result.items.length)("totalLength",i.dataSource.result.totalCount)("totalIsEstimate",!1)("showLastPage",!0)}}var _t=(()=>{let t=class t{constructor(){this.apollo=v(K),this.errorsService=v(ee),this.breakpoints=v(te),this.transloco=v(W),this.controller=new T,this.dataSource=new q(this.apollo,this.errorsService,this.controller.variables$),this.selection=new G,this.orderByOptions=B,this.facets$=this.controller.controls$.pipe(I(this.dataSource.result$),C(([r,i])=>Ce.map(s=>p(c(c({},s),s.extractInput(r.facets)),{aggregations:s.extractAggregations(i.aggregations).map(_=>p(c({},_),{label:s.resolveLabel(_,this.transloco)}))})))),this.controller.controls$.subscribe(r=>{this.controls=r})}};t.\u0275fac=function(i){return new(i||t)},t.\u0275cmp=J({type:t,selectors:[["app-queue-jobs"]],standalone:!0,features:[z],decls:1,vars:0,consts:[["drawer",""],[4,"transloco"],[1,"drawer-container"],[1,"drawer",3,"mode","opened"],[1,"query-form"],[1,"form-field-container","button-container","button-container-toggle-drawer"],["type","button","mat-icon-button","",1,"button-toggle-drawer",3,"click","matTooltip"],["fontSet","material-icons"],[1,"form-field-container","form-field-container-order-by"],["subscriptSizing","dynamic"],[3,"valueChange","value"],[3,"value"],["mat-icon-button","",3,"click","matTooltip"],[1,"form-field-container","button-container","button-container-refresh"],["mat-mini-fab","","color","primary",3,"click","matTooltip"],[3,"dataSource","selection"],[3,"paging","page","pageSize","pageLength","totalLength","totalIsEstimate","showLastPage"],[1,"filtered"],[1,"unfiltered"],[3,"checked"],[3,"change","checked"],["checked","true"],["checked","true",3,"change"]],template:function(i,s){i&1&&$(0,Fe,29,20,"ng-container",1)},dependencies:[fe,U,Z,X,re,ae,se,oe,ce,ne,ie,le,pe,de,_e,me,ue,Y,N,H,be,he],styles:[".drawer[_ngcontent-%COMP%]{width:220px}.query-form[_ngcontent-%COMP%]{padding-top:20px;padding-bottom:10px;position:relative;clear:both;display:flex;flex-wrap:wrap}.query-form[_ngcontent-%COMP%]   .form-field-container[_ngcontent-%COMP%]{display:inline-flex;flex-direction:column;position:relative;margin-left:20px;padding-bottom:20px}.query-form[_ngcontent-%COMP%]   .form-field-container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{top:8px}.query-form[_ngcontent-%COMP%]   .form-field-container.form-field-container-order-by[_ngcontent-%COMP%]{padding-right:40px}.query-form[_ngcontent-%COMP%]   .form-field-container.form-field-container-order-by[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{position:absolute;right:0}.query-form[_ngcontent-%COMP%]   .form-field-container.button-container-toggle-drawer[_ngcontent-%COMP%]{margin-left:5px}.query-form[_ngcontent-%COMP%]   .button-container-toggle-direction[_ngcontent-%COMP%]{margin-left:4px}app-paginator[_ngcontent-%COMP%]{float:right;padding-top:14px;padding-bottom:20px}"]});let e=t;return e})();export{_t as QueueJobsComponent};
