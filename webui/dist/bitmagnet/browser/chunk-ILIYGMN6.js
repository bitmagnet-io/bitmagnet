import{b as Fe,c as Re}from"./chunk-B6NRR3LN.js";import"./chunk-RQ2LQKI2.js";import"./chunk-42PJPEMD.js";import{a as ue}from"./chunk-RQJCZYHN.js";import{a as je}from"./chunk-BIN4GQHP.js";import{a as Ae}from"./chunk-DSEDLZDW.js";import{Ba as Te,Ea as j,Fa as we,Ga as Me,Ha as Je,I as _e,Ia as Ie,Ja as Ee,Ka as Pe,La as $e,Ma as Qe,Na as ke,Oa as Oe,Pa as Ve,Q as ge,Qa as De,R as xe,Ra as qe,S as fe,Sa as Be,V as be,W as Ce,X as he,_ as ve,_a as A,a as B,b as F,h as ce,ha as ye,n as se,s as pe,v as de,w as me,wa as Se}from"./chunk-52FBNZ2Q.js";import{c as re,d as ae,g as N,h as W,i as le}from"./chunk-6XXA7HXI.js";import"./chunk-CMNWCZJM.js";import{$b as l,B as P,Cb as u,Ea as _,Fa as g,Gb as O,Hb as d,Kb as H,Mb as E,N as U,Na as ee,O as X,Ob as $,Pb as Q,Q as Z,Qb as a,Rb as c,Sb as J,Tb as h,Ub as v,Wb as y,Zb as x,a as f,ad as D,b,bd as q,cd as oe,jc as z,kb as r,kc as p,l as w,lc as S,mc as m,o as K,pc as V,qa as I,qc as te,tc as ie,ua as k,vc as T,wc as M,yc as ne}from"./chunk-Z3WUIYN5.js";var Ue=()=>["expandedDetail"];function Xe(t,n){t&1&&(a(0,"th",18),p(1,"ID"),c())}function Ze(t,n){if(t&1){let e=y();a(0,"td",19),x("click",function(o){let s=_(e).$implicit;return l(2).toggleQueueJobId(s.id),g(o.stopPropagation())}),p(1),c()}if(t&2){let e=n.$implicit,i=l(2);r(),m(" ",i.item(e).id," ")}}function et(t,n){if(t&1&&(a(0,"th",18),p(1),c()),t&2){let e=l().$implicit;r(),m(" ",e("dashboard.queues.queue")," ")}}function tt(t,n){if(t&1){let e=y();a(0,"td",19),x("click",function(o){let s=_(e).$implicit;return l(2).toggleQueueJobId(s.id),g(o.stopPropagation())}),p(1),c()}if(t&2){let e=n.$implicit,i=l(2);r(),m(" ",i.item(e).queue," ")}}function it(t,n){if(t&1&&(a(0,"th",18),p(1),c()),t&2){let e=l().$implicit;r(),m(" ",e("dashboard.queues.priority")," ")}}function nt(t,n){if(t&1){let e=y();a(0,"td",19),x("click",function(o){let s=_(e).$implicit;return l(2).toggleQueueJobId(s.id),g(o.stopPropagation())}),p(1),T(2,"number"),c()}if(t&2){let e=n.$implicit,i=l(2);r(),m(" ",M(2,1,i.item(e).priority)," ")}}function ot(t,n){if(t&1&&(a(0,"th",18),p(1),c()),t&2){let e=l().$implicit;r(),m(" ",e("general.status")," ")}}function rt(t,n){if(t&1){let e=y();a(0,"td",19),x("click",function(o){let s=_(e).$implicit;return l(2).toggleQueueJobId(s.id),g(o.stopPropagation())}),p(1),c()}if(t&2){let e=n.$implicit,i=l(2);r(),m(" ",i.item(e).status," ")}}function at(t,n){if(t&1&&(a(0,"th",18),p(1),c()),t&2){let e=l().$implicit;r(),S(e("general.error"))}}function lt(t,n){if(t&1&&(p(0),T(1,"slice")),t&2){let e=l().$implicit,i=l(2);m(" ",ne(1,1,i.item(e).error,0,20)+"..."," ")}}function ct(t,n){if(t&1){let e=y();a(0,"td",19),x("click",function(o){let s=_(e).$implicit;return l(2).toggleQueueJobId(s.id),g(o.stopPropagation())}),u(1,lt,2,5),c()}if(t&2){let e=n.$implicit;r(),E(e.error?1:-1)}}function st(t,n){if(t&1&&(a(0,"th",20),p(1),c()),t&2){let e=l().$implicit;r(),m(" ",e("dashboard.queues.created_at")," ")}}function pt(t,n){if(t&1){let e=y();a(0,"td",19),x("click",function(o){let s=_(e).$implicit;return l(2).toggleQueueJobId(s.id),g(o.stopPropagation())}),p(1),T(2,"timeAgo"),c()}if(t&2){let e=n.$implicit,i=l(2);r(),m(" ",M(2,1,i.item(e).createdAt)," ")}}function dt(t,n){if(t&1&&(a(0,"th",20),p(1),c()),t&2){let e=l().$implicit;r(),m(" ",e("dashboard.queues.ran_at")," ")}}function mt(t,n){t&1&&(p(0),T(1,"timeAgo")),t&2&&m(" ",M(1,1,n)," ")}function ut(t,n){if(t&1){let e=y();a(0,"td",19),x("click",function(o){let s=_(e).$implicit;return l(2).toggleQueueJobId(s.id),g(o.stopPropagation())}),u(1,mt,2,3),c()}if(t&2){let e,i=n.$implicit;r(),E((e=i.ranAt)?1:-1,e)}}function _t(t,n){if(t&1&&(a(0,"h5")(1,"span",23),p(2),c()(),a(3,"pre",24),p(4),c()),t&2){let e=n,i=l(2).$implicit;r(),d("matTooltip",i("torrents.copy_to_clipboard"))("cdkCopyToClipboard",e),r(),m("",i("general.error"),":"),r(2),S(e)}}function gt(t,n){if(t&1&&(a(0,"td",21)(1,"div",22)(2,"p")(3,"strong"),p(4,"ID:"),c(),p(5,"\xA0"),a(6,"span",23),p(7),c()(),a(8,"h5")(9,"span",23),p(10),c()(),a(11,"pre",24),p(12),c(),u(13,_t,5,4),c()()),t&2){let e,i=n.$implicit,o=l().$implicit,s=l();O("colspan",s.displayedColumns.length),r(),d("@detailExpand",s.expandedId.getValue()===i.id?"expanded":"collapsed"),r(5),d("matTooltip",o("torrents.copy_to_clipboard"))("cdkCopyToClipboard",s.item(i).id),r(),S(s.item(i).id),r(2),d("matTooltip",o("torrents.copy_to_clipboard"))("cdkCopyToClipboard",s.item(i).payload),r(),m("",o("dashboard.queues.payload"),":"),r(2),S(s.beautifyPayload(s.item(i).payload)),r(),E((e=s.item(i).error)?13:-1,e)}}function xt(t,n){t&1&&J(0,"tr",25)}function ft(t,n){if(t&1&&J(0,"tr",26),t&2){let e=n.$implicit,i=l(2);H("summary-row "+(e.id===i.expandedId.getValue()?"expanded":"collapsed"))}}function bt(t,n){if(t&1&&J(0,"tr",26),t&2){let e=n.$implicit,i=l(2);H("expanded-detail-row "+(e.id===i.expandedId.getValue()?"expanded":"collapsed"))}}function Ct(t,n){if(t&1&&(h(0),a(1,"div",1),J(2,"mat-progress-bar",2),T(3,"async"),c(),a(4,"table",3),h(5,4),u(6,Xe,2,0,"th",5)(7,Ze,2,1,"td",6),v(),h(8,7),u(9,et,2,1,"th",5)(10,tt,2,1,"td",6),v(),h(11,8),u(12,it,2,1,"th",5)(13,nt,3,3,"td",6),v(),h(14,9),u(15,ot,2,1,"th",5)(16,rt,2,1,"td",6),v(),h(17,10),u(18,at,2,1,"th",5)(19,ct,2,1,"td",6),v(),h(20,11),u(21,st,2,1,"th",12)(22,pt,3,3,"td",6),v(),h(23,13),u(24,dt,2,1,"th",12)(25,ut,2,1,"td",6),v(),h(26,14),u(27,gt,14,10,"td",15),v(),u(28,xt,1,0,"tr",16)(29,ft,1,2,"tr",17)(30,bt,1,2,"tr",17),c(),v()),t&2){let e=l();r(2),d("mode",M(3,7,e.dataSource.loading$)?"indeterminate":"determinate")("value",0),r(2),d("dataSource",e.dataSource)("multiTemplateDataRows",!0),r(24),d("matHeaderRowDef",e.displayedColumns),r(),d("matRowDefColumns",e.displayedColumns),r(),d("matRowDefColumns",te(9,Ue))}}var Le=(()=>{class t{constructor(){this.transloco=I(B),this.displayedColumns=ht,this.updated=new ee,this.expandedId=new w(null),this.items=Array()}ngOnInit(){this.dataSource.items$.subscribe(e=>{if(this.items=e,e.length){let i=this.expandedId.getValue();i&&!e.some(({id:o})=>o===i)&&this.expandedId.next(null)}})}isAllSelected(){return this.items.every(e=>this.selection.isSelected(e.id))}toggleAllRows(){if(this.isAllSelected()){this.selection.clear();return}this.selection.select(...this.items.map(e=>e.id))}toggleQueueJobId(e){this.expandedId.getValue()===e?this.expandedId.next(null):this.expandedId.next(e)}item(e){return e}beautifyPayload(e){try{return JSON.stringify(JSON.parse(e),null,2)}catch{return e}}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=k({type:t,selectors:[["app-queue-jobs-table"]],inputs:{dataSource:"dataSource",selection:"selection",displayedColumns:"displayedColumns"},outputs:{updated:"updated"},standalone:!0,features:[V],decls:1,vars:0,consts:[[4,"transloco"],[1,"progress-bar-container"],[3,"mode","value"],["mat-table","",1,"table-results",3,"dataSource","multiTemplateDataRows"],["matColumnDef","id"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",3,"click",4,"matCellDef"],["matColumnDef","queue"],["matColumnDef","priority"],["matColumnDef","status"],["matColumnDef","error"],["matColumnDef","createdAt"],["mat-header-cell","","style","text-align: center",4,"matHeaderCellDef"],["matColumnDef","ranAt"],["matColumnDef","expandedDetail"],["mat-cell","",4,"matCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",3,"class",4,"matRowDef","matRowDefColumns"],["mat-header-cell",""],["mat-cell","",3,"click"],["mat-header-cell","",2,"text-align","center"],["mat-cell",""],[1,"item-detail"],[1,"copy",3,"matTooltip","cdkCopyToClipboard"],[1,"payload"],["mat-header-row",""],["mat-row",""]],template:function(i,o){i&1&&u(0,Ct,31,10,"ng-container",0)},dependencies:[A,ge,Te,Ee,$e,Ve,Qe,Pe,De,ke,Oe,qe,Be,j,F,D,oe,q,Re],styles:[".item-detail[_ngcontent-%COMP%] > [_ngcontent-%COMP%]:first-child{padding-top:20px}.item-detail[_ngcontent-%COMP%] > [_ngcontent-%COMP%]:last-child{margin-bottom:20px}tr[_ngcontent-%COMP%]:not(.expanded-detail-row)   td[_ngcontent-%COMP%]{cursor:pointer}tr.expanded-detail-row[_ngcontent-%COMP%]{height:0}tr.expanded-detail-row[_ngcontent-%COMP%]   h5[_ngcontent-%COMP%]{margin:0;padding-top:8px}tr.expanded-detail-row[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;padding-top:8px;padding-bottom:4px}tr.expanded-detail-row[_ngcontent-%COMP%]   span.copy[_ngcontent-%COMP%]{cursor:crosshair;text-decoration:underline;text-decoration-style:dotted}pre[_ngcontent-%COMP%]{opacity:0;max-height:200px;max-width:100px;overflow:scroll;background:#7773;padding:10px}.expanded-detail-row.expanded[_ngcontent-%COMP%]   pre[_ngcontent-%COMP%]{opacity:1;max-width:1200px}"],data:{animation:[re("detailExpand",[W("collapsed,void",N({height:"0px",minHeight:"0"})),W("expanded",N({height:"*"})),le("expanded <=> collapsed",ae("225ms cubic-bezier(0.4, 0.0, 0.2, 1)"))])]}})}}return t})(),ht=["id","queue","priority","status","error","createdAt","ranAt"];var vt={items:[],hasNextPage:!1,totalCount:0,aggregations:{queue:[],status:[]}},R=class{constructor(n,e,i){this.apollo=n,this.errorsService=e,this.currentRequest=new w(0),this.loadingSubject=new w(!1),this.loading$=this.loadingSubject.asObservable(),this.result=vt,this.resultSubject=new w(this.result),this.result$=this.resultSubject.asObservable(),this.items$=this.resultSubject.pipe(P(o=>o.items)),i.subscribe(o=>{this.variables=o,this.loadResult(o)}),this.resultSubject.subscribe(o=>{this.result=o})}connect({}){return this.items$}disconnect(){this.resultSubject.complete()}refresh(){this.variables&&this.loadResult(this.variables)}loadResult(n){this.currentSubscription&&(this.currentSubscription.unsubscribe(),this.currentSubscription=void 0),this.loadingSubject.next(!0);let e=this.currentRequest.getValue()+1;this.currentRequest.next(e);let i=this.apollo.query({query:_e,variables:n,fetchPolicy:"no-cache"}).pipe(P(o=>o.data.queue.jobs)).pipe(U(o=>(this.errorsService.addError(`Error loading item results: ${o.message}`),K)));this.currentSubscription=i.subscribe(o=>{e===this.currentRequest.getValue()&&(this.loadingSubject.next(!1),this.resultSubject.next(o))})}};var L=class{constructor(n=yt){this.controlsSubject=new w(n),this.controls$=this.controlsSubject.asObservable(),this.variablesSubject=new w(He(n)),this.variables$=this.variablesSubject.asObservable(),this.controls$.pipe(Z(100)).subscribe(e=>{let i=this.variablesSubject.getValue(),o=He(e);JSON.stringify(i)!==JSON.stringify(o)&&this.variablesSubject.next(o)})}update(n){let e=this.controlsSubject.getValue(),i=n(e);JSON.stringify(e)!==JSON.stringify(i)&&this.controlsSubject.next(i)}activateFilter(n,e){this.update(i=>{let o=n.extractInput(i.facets);return b(f({},i),{page:1,facets:n.patchInput(i.facets,b(f({},o),{filter:Array.from(new Set([...o.filter??[],e])).sort()}))})})}deactivateFilter(n,e){this.update(i=>{let o=n.extractInput(i.facets),s=o.filter?.filter(C=>C!==e);return b(f({},i),{page:1,facets:n.patchInput(i.facets,b(f({},o),{filter:s?.length?s:void 0}))})})}selectOrderBy(n){let e={field:n,descending:Y.find(i=>i.field===n)?.descending??!1};this.update(i=>b(f({},i),{orderBy:e,page:1}))}toggleOrderByDirection(){this.update(n=>b(f({},n),{orderBy:b(f({},n.orderBy),{descending:!n.orderBy.descending}),page:1}))}handlePageEvent(n){this.update(e=>b(f({},e),{limit:n.pageSize,page:n.page}))}},He=t=>({input:{limit:t.limit,page:t.page,totalCount:!0,orderBy:[t.orderBy,...t.orderBy.field!=="created_at"?[{field:"created_at",descending:t.orderBy.descending}]:[]],queues:t.queues,statuses:t.statuses,facets:{queue:{aggregate:!0,filter:t.facets.queue.filter},status:{aggregate:!0,filter:t.facets.status.filter}}}}),Y=[{field:"created_at",descending:!0},{field:"ran_at",descending:!0},{field:"priority",descending:!1}],yt={limit:20,page:1,orderBy:{field:"ran_at",descending:!0},facets:{queue:{},status:{}}},St={key:"queue",extractInput:t=>t.queue,patchInput:(t,n)=>b(f({},t),{queue:n}),extractAggregations:t=>t.queue??[],resolveLabel:t=>t.label},Tt={key:"status",extractInput:t=>t.status,patchInput:(t,n)=>b(f({},t),{status:n}),extractAggregations:t=>t.status??[],resolveLabel:(t,n)=>n.translate("dashboard.queues."+t.label)},ze=[St,Tt];var wt=(t,n)=>n.key,Mt=(t,n)=>n.field,Ne=(t,n)=>n.value,Jt=(t,n,e)=>[t,n,e];function It(t,n){if(t&1){let e=y();a(0,"mat-checkbox",21),x("change",function(o){let s=_(e).$implicit,C=l(2).$implicit,G=l(2);return g(o.checked?G.controller.activateFilter(C,s.value):G.controller.deactivateFilter(C,s.value))}),p(1),a(2,"small"),p(3),T(4,"number"),c()()}if(t&2){let e=n.$implicit,i=l(2).$implicit;d("checked",i.filter==null?null:i.filter.includes(e.value)),r(),m(" ",e.label," "),r(2),S(M(4,3,e.count))}}function Et(t,n){if(t&1&&(a(0,"mat-card-content",18),$(1,It,5,5,"mat-checkbox",20,Ne),c()),t&2){let e=l().$implicit;r(),Q(e.aggregations)}}function Pt(t,n){if(t&1){let e=y();a(0,"mat-checkbox",23),x("change",function(){let o=_(e).$implicit,s=l(2).$implicit,C=l(2);return g(C.controller.activateFilter(s,o.value))}),p(1),a(2,"small"),p(3),T(4,"number"),c()()}if(t&2){let e=n.$implicit;r(),m(" ",e.label," "),r(2),S(M(4,2,e.count))}}function $t(t,n){if(t&1&&(a(0,"mat-card-content",19),$(1,Pt,5,4,"mat-checkbox",22,Ne),c()),t&2){let e=l().$implicit;r(),Q(e.aggregations)}}function Qt(t,n){if(t&1&&(a(0,"mat-card")(1,"mat-card-header")(2,"mat-card-title"),p(3),c()(),u(4,Et,3,0,"mat-card-content",18)(5,$t,3,0,"mat-card-content",19),c()),t&2){let e=n.$implicit,i=l().$implicit;r(3),m(" ",i("facets."+e.key)," "),r(),E(e.filter!=null&&e.filter.length?4:5)}}function kt(t,n){if(t&1&&(a(0,"mat-option",12),p(1),c()),t&2){let e=n.$implicit,i=l().$implicit;d("value",e.field),r(),m(" ",i("dashboard.queues."+e.field)," ")}}function Ot(t,n){if(t&1){let e=y();h(0),J(1,"app-document-title",2),a(2,"mat-drawer-container",3)(3,"mat-drawer",4,0),$(5,Qt,6,2,"mat-card",null,wt),T(7,"async"),c(),a(8,"mat-drawer-content")(9,"div",5)(10,"div",6)(11,"button",7),x("click",function(){_(e);let o=z(4);return g(o.toggle())}),a(12,"mat-icon",8),p(13),c()()(),a(14,"div",9)(15,"mat-form-field",10)(16,"mat-label"),p(17),c(),a(18,"mat-select",11),x("valueChange",function(o){_(e);let s=l();return g(s.controller.selectOrderBy(o))}),$(19,kt,2,2,"mat-option",12,Mt),c()(),a(21,"button",13),x("click",function(){_(e);let o=l();return g(o.controller.toggleOrderByDirection())}),a(22,"mat-icon"),p(23),c()()(),a(24,"div",14)(25,"button",15),x("click",function(){_(e);let o=l();return g(o.dataSource.refresh())}),a(26,"mat-icon"),p(27,"sync"),c()()()(),J(28,"app-queue-jobs-table",16),a(29,"app-paginator",17),x("paging",function(o){_(e);let s=l();return g(s.controller.handlePageEvent(o))}),c()()(),v()}if(t&2){let e=n.$implicit,i=z(4),o=l();r(),d("parts",ie(21,Jt,e("routes.jobs"),e("routes.queues"),e("routes.dashboard"))),r(2),d("mode",o.breakpoints.sizeAtLeast("Medium")?"side":"over")("opened",o.breakpoints.sizeAtLeast("Medium")),O("role",o.breakpoints.sizeAtLeast("Medium")?"navigation":"dialog"),r(2),Q(M(7,19,o.facets$)),r(6),d("matTooltip",e("torrents.toggle_drawer")),r(2),S(i.opened?"arrow_circle_left":"arrow_circle_right"),r(4),S(e("torrents.order_by")),r(),d("value",o.controls.orderBy.field),r(),Q(o.orderByOptions),r(2),d("matTooltip",e("torrents.order_direction_toggle")),r(2),S(o.controls.orderBy.descending?"arrow_downward":"arrow_upward"),r(2),d("matTooltip",e("torrents.refresh")),r(3),d("dataSource",o.dataSource)("selection",o.selection),r(),d("page",o.controls.page)("pageSize",o.controls.limit)("pageLength",o.dataSource.result.items.length)("totalLength",o.dataSource.result.totalCount)("totalIsEstimate",!1)("showLastPage",!0)}}var Ti=(()=>{class t{constructor(){this.apollo=I(ce),this.errorsService=I(ue),this.breakpoints=I(je),this.transloco=I(B),this.controller=new L,this.dataSource=new R(this.apollo,this.errorsService,this.controller.variables$),this.selection=new se,this.orderByOptions=Y,this.facets$=this.controller.controls$.pipe(X(this.dataSource.result$),P(([e,i])=>ze.map(o=>b(f(f({},o),o.extractInput(e.facets)),{aggregations:o.extractAggregations(i.aggregations).map(s=>b(f({},s),{label:o.resolveLabel(s,this.transloco)}))})))),this.controller.controls$.subscribe(e=>{this.controls=e})}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=k({type:t,selectors:[["app-queue-jobs"]],standalone:!0,features:[V],decls:1,vars:0,consts:[["drawer",""],[4,"transloco"],[3,"parts"],[1,"drawer-container"],[1,"drawer",3,"mode","opened"],[1,"query-form"],[1,"form-field-container","button-container","button-container-toggle-drawer"],["type","button","mat-icon-button","",1,"button-toggle-drawer",3,"click","matTooltip"],["fontSet","material-icons"],[1,"form-field-container","form-field-container-order-by"],["subscriptSizing","dynamic"],[3,"valueChange","value"],[3,"value"],["mat-icon-button","",3,"click","matTooltip"],[1,"form-field-container","button-container","button-container-refresh"],["mat-mini-fab","","color","primary",3,"click","matTooltip"],[3,"dataSource","selection"],[3,"paging","page","pageSize","pageLength","totalLength","totalIsEstimate","showLastPage"],[1,"filtered"],[1,"unfiltered"],[3,"checked"],[3,"change","checked"],["checked","true"],["checked","true",3,"change"]],template:function(i,o){i&1&&u(0,Ot,30,25,"ng-container",1)},dependencies:[A,pe,me,de,be,he,ve,Ce,ye,fe,xe,Se,we,Je,Ie,Me,j,F,D,q,Fe,Le,Ae],styles:[".drawer[_ngcontent-%COMP%]{width:220px}.query-form[_ngcontent-%COMP%]{padding-top:20px;padding-bottom:10px;position:relative;clear:both;display:flex;flex-wrap:wrap}.query-form[_ngcontent-%COMP%]   .form-field-container[_ngcontent-%COMP%]{display:inline-flex;flex-direction:column;position:relative;margin-left:20px;padding-bottom:20px}.query-form[_ngcontent-%COMP%]   .form-field-container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{top:8px}.query-form[_ngcontent-%COMP%]   .form-field-container.form-field-container-order-by[_ngcontent-%COMP%]{padding-right:40px}.query-form[_ngcontent-%COMP%]   .form-field-container.form-field-container-order-by[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{position:absolute;right:0}.query-form[_ngcontent-%COMP%]   .form-field-container.button-container-toggle-drawer[_ngcontent-%COMP%]{margin-left:5px}.query-form[_ngcontent-%COMP%]   .button-container-toggle-direction[_ngcontent-%COMP%]{margin-left:4px}app-paginator[_ngcontent-%COMP%]{float:right;padding-top:14px;padding-bottom:20px}"]})}}return t})();export{Ti as QueueJobsComponent};
